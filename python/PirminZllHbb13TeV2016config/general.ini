#! -------------------------
#!! GENERAL CONFIGURATION
#!! -------------------------

[General]

#Set as the lumi of each sample. What is the effect of this ? Doesn't seem to change anything for the ploting
; lumi = 1

#Set to True or False to display debug messages
Debug: True

[Analysis]
tag = 13TeV

# BDT to discriminate Signal and Background
#!! If this Flag is used then 50% of MC samples will go in training and the rest will be scaled up by a factor of 2.
#!! if you train on 50% but then set it to 'False' while writing DC, then you get your biased training samples in the limit!!!
#!! be sure to have this right !!!
;#When computing SF from CR, set this flag to false
;if one wants to use Mjj -> put to False
;Rescale MC by factor 2 if true
TrainFlag = True
;TrainFlag = False

;Current BDT FOM: Cls of train/vs CLs of test sample. To produce the DC on train sample, set this flag to True.
;!!!IMPORTANT: BE SURE TO HAVE "UseTrainSample = False" WHEN COMPUTING THE FINAL LIMIT !!!
UseTrainSample = False
;UseTrainSample = True

;ALWAYS set to False, unless training to produce correlation plots
Data_as_signal = False

;Enable to re-compute Vtype during the sys step and to implicitly cut on the new variable: "Vtype_new == 0 || Vtype_new == 1" (V25)
Recompute_Vtype = True
;Recompute_Vtype = False
;
;;Stop after doing the Vtype recomputation, has no effect if Recompute_Vtype is set to False (V25)
;Stop_after_Vtype_correction = True
Stop_after_Vtype_correction = False

;Stop after adding the Btag weigts. Has no effect if applyBTagweights is set to False
Stop_after_BTagweights = True

ApplyCutDuringSys = True

;!! -------------------------
;!! REGRESSION
;!! -------------------------
[Regression]
;Set to True for the  regression to be included during the 'sys' step.
;applyRegression = True
applyRegression = False
;applyBTagweights = False
applyBTagweights = True
writeNewVariables={'sys_LooseIso':'(((Vtype == 0) & (vLeptons_relIso04[0] < 0.25 & vLeptons_relIso04[1] < 0.25)) || ((Vtype == 1) & vLeptons_relIso03[0] < 0.15 & vLeptons_relIso03[1] < 0.15 ))', 'sys_puID':'((min(Jet_puId[hJCidx[0]],Jet_puId[hJCidx[1]]) >= 7 & Jet_btagCSV[hJCidx[1]] > 0.52 & Jet_btagCSV[hJCidx[1]] < 0.55) || !(Jet_btagCSV[hJCidx[1]] > 0.52 & Jet_btagCSV[hJCidx[1]] < 0.55))', 'sys_nopuHiggs':'(Jet_puId[hJCidx[1]] >= 4) & (Jet_puId[hJCidx[0]] >= 4)', 'sys_leppT':'vLeptons_pt[0] > 20 & vLeptons_pt[1] > 20', 'sys_BasicCuts':'(((Vtype == 0) & (vLeptons_relIso04[0] < 0.25 & vLeptons_relIso04[1] < 0.25)) || ((Vtype == 1) & vLeptons_relIso03[0] < 0.15 & vLeptons_relIso03[1] < 0.15 )) & ((min(Jet_puId[hJCidx[0]],Jet_puId[hJCidx[1]]) >= 7 & Jet_btagCSV[hJCidx[1]] > 0.52 & Jet_btagCSV[hJCidx[1]] < 0.55) || !(Jet_btagCSV[hJCidx[1]] > 0.52 & Jet_btagCSV[hJCidx[1]] < 0.55)) & (Jet_puId[hJCidx[1]] >= 4) & (Jet_puId[hJCidx[0]] >= 4) & vLeptons_pt[0] > 20 & vLeptons_pt[1] > 20'}

;regWeight = weights/MVA_BDT_REG_ZllHbbRegression_ZH_HToBB_ZToLL_M125_pow.weights.xml
regWeight = weights/TMVARegression_BDTG.weights.xml

; ##regVars## must be compatible with [TrainRegression] -> Vars
regVars = ['Jet_pt','nPVs','Jet_eta','Jet_mt','Jet_leadTrackPt','Jet_leptonPtRel','Jet_leptonPt','Jet_leptonDeltaR','Jet_neHEF','Jet_neEmEF','Jet_vtxPt','Jet_vtxMass','Jet_vtx3dL','Jet_vtxNtrk','Jet_vtx3deL']

; ##regDict## must contain exactly all ##regVars##
; it is a dictionary between Jet_vtxPt[hJCidx]:Jet_vtxPt[hJCidx[0]]
regDict = {'Jet_pt':'Alt$(Jet_pt[hJCidx[0]],0)','nPVs':'Alt$(nPVs,0)','Jet_eta':'Alt$(Jet_eta[hJCidx[0]],0)','Jet_mt':'Alt$(Jet_mt[hJCidx[0]],0)','Jet_leadTrackPt':'Alt$(Jet_leadTrackPt[hJCidx[0]],0)','Jet_leptonPtRel':'max(Alt$(Jet_leptonPtRel[hJCidx[0]],0),0)','Jet_leptonPt':'max(Alt$(Jet_leptonPt[hJCidx[0]],0),0)','Jet_leptonDeltaR':'max(Alt$(Jet_leptonDeltaR[hJCidx[0]],0),0)','Jet_neHEF':'Alt$(Jet_neHEF[hJCidx[0]],0)','Jet_neEmEF':'Alt$(Jet_neEmEF[hJCidx[0]],0)','Jet_vtxPt':'Alt$(Jet_vtxPt[hJCidx[0]],0)','Jet_vtxMass':'Alt$(Jet_vtxMass[hJCidx[0]],0)','Jet_vtx3dL':'Alt$(Jet_vtx3DVal[hJCidx[0]],0)','Jet_vtxNtrk':'Alt$(Jet_vtxNtracks[hJCidx[0]],0)','Jet_vtx3deL':'Alt$(Jet_vtx3DSig[hJCidx[0]],0)'}

regWeightFilterJets = weights/MVA_BDT_REG_MyRegression.weights.xml
regDictFilterJets = {"fathFilterJets_pt":"fathFilterJets_pt[0]","VHbb::evalJERBias(fathFilterJets_ptRaw,fathFilterJets_genPt,fathFilterJets_eta)":"VHbb::evalJERBias(fathFilterJets_ptRaw[0],fathFilterJets_genPt[0],fathFilterJets_eta[0])","rho25":"rho25","VHbb::evalEt(fathFilterJets_pt,fathFilterJets_eta,fathFilterJets_phi,fathFilterJets_e)":"VHbb::evalEt(fathFilterJets_pt[0],fathFilterJets_eta[0],fathFilterJets_phi[0],fathFilterJets_e[0])","VHbb::evalMt(fathFilterJets_pt,fathFilterJets_eta,fathFilterJets_phi,fathFilterJets_e)":"VHbb::evalMt(fathFilterJets_pt[0],fathFilterJets_eta[0],fathFilterJets_phi[0],fathFilterJets_e[0])","fathFilterJets_ptLeadTrack":"fathFilterJets_ptLeadTrack[0]","metPuppi_pt":"METet","VHbb::deltaPhi(met_phi,fathFilterJets_phi)":"VHbb::deltaPhi(met_phi,fathFilterJets_phi[0])"}
regVarsFilterJets = ["fathFilterJets_pt","VHbb::evalJERBias(fathFilterJets_ptRaw,fathFilterJets_genPt,fathFilterJets_eta)","rho25","VHbb::evalEt(fathFilterJets_pt,fathFilterJets_eta,fathFilterJets_phi,fathFilterJets_e)","VHbb::evalMt(fathFilterJets_pt,fathFilterJets_eta,fathFilterJets_phi,fathFilterJets_e)","fathFilterJets_ptLeadTrack","metPuppi_pt","VHbb::deltaPhi(met_phi,fathFilterJets_phi)"]


;#Need this for the plotting
[VHbbNameSpace]
library=<!Directories|vhbbpath!>/interface/VHbbNameSpace_h.so
[BTagReshaping]
library=<!Directories|vhbbpath!>/interface/BTagReshaping_h.so
[BTagHFweights]
file=<!Directories|vhbbpath!>/python/weights/csv_rwt_fit_hf_76x_2016_02_08.root
[BTagLFweights]
file=<!Directories|vhbbpath!>/python/weights/csv_rwt_fit_lf_76x_2016_02_08.root

;;!! for the likelihood
[AngularLike]
backgrounds = ['Zbb','Zudsg','ttbar','ZZ']
yields = {'Zbb':584.8,'Zudsg':881.61,'ttbar':135.7,'ZZ':44.04,'Sig':5.13}

;!! --------------------------
;!! SYSTEMATICS
;!! --------------------------
;Note: it seems that the shape sys are hardcode in evaluateMVA. The lines below don't seem to have any effect for the moment
[systematics]
systematics: Nominal JER_Up_HighCentral JER_Down_HighCentral JER_Up_LowCentral JER_Down_LowCentral JER_Up_HighForward JER_Down_HighForward JER_Up_LowForward JER_Down_LowForward JEC_Up_HighCentral JEC_Down_HighCentral JEC_Up_LowCentral JEC_Down_LowCentral JEC_Up_HighForward JEC_Down_HighForward JEC_Up_LowForward JEC_Down_LowForward

;!! --------------------------------------------------
;!! Varibles definition for trainging and evaluation
;!! --------------------------------------------------

;Sync with David
[ZllBDTVars]

;using the update from Sean

Nominal: HCSV_reg_mass HCSV_reg_pt VHbb::deltaPhi(HCSV_reg_phi,V_phi) Jet_btagCSV[hJCidx[0]] Jet_btagCSV[hJCidx[1]] Jet_pt_reg[hJCidx[0]] Jet_pt_reg[hJCidx[1]] V_mass Sum$(Jet_pt_reg>30&&abs(Jet_eta)<2.4&&Jet_puId==7&&Jet_id>0&&aJCidx!=(hJCidx[0])&&(aJCidx!=(hJCidx[1]))) V_pt (HCSV_reg_pt/V_pt) abs(Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]]) softActivityVH_njets5 VHbb::deltaR(HCSV_reg_eta,HCSV_reg_phi,V_eta,V_phi) met_pt

JER_Up_HighCentral: HCSV_reg_corrJERUp_mass_HighCentral HCSV_reg_corrJERUp_pt_HighCentral VHbb::deltaPhi(HCSV_reg_corrJERUp_phi_HighCentral,V_phi) Jet_btagCSV[hJCidx[0]] Jet_btagCSV[hJCidx[1]] Jet_pt_reg_corrJERUp_HighCentral[hJCidx[0]] Jet_pt_reg_corrJERUp_HighCentral[hJCidx[1]] V_mass Sum$(Jet_pt_reg_corrJERUp_HighCentral>30&&abs(Jet_eta)<2.4&&Jet_puId==7&&Jet_id>0&&aJCidx!=(hJCidx[0])&&(aJCidx!=(hJCidx[1]))) V_pt (HCSV_reg_corrJERUp_pt_HighCentral/V_pt) abs(Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]]) softActivityVH_njets5 VHbb::deltaR(HCSV_reg_corrJERUp_eta_HighCentral,HCSV_reg_corrJERUp_phi_HighCentral,V_eta,V_phi) met_pt

JER_Down_HighCentral: HCSV_reg_corrJERDown_mass_HighCentral HCSV_reg_corrJERDown_pt_HighCentral VHbb::deltaPhi(HCSV_reg_corrJERDown_phi_HighCentral,V_phi) Jet_btagCSV[hJCidx[0]] Jet_btagCSV[hJCidx[1]] Jet_pt_reg_corrJERDown_HighCentral[hJCidx[0]] Jet_pt_reg_corrJERDown_HighCentral[hJCidx[1]] V_mass Sum$(Jet_pt_reg_corrJERDown_HighCentral>30&&abs(Jet_eta)<2.4&&Jet_puId==7&&Jet_id>0&&aJCidx!=(hJCidx[0])&&(aJCidx!=(hJCidx[1]))) V_pt (HCSV_reg_corrJERDown_pt_HighCentral/V_pt) abs(Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]]) softActivityVH_njets5 VHbb::deltaR(HCSV_reg_corrJERDown_eta_HighCentral,HCSV_reg_corrJERDown_phi_HighCentral,V_eta,V_phi) met_pt

JER_Up_LowCentral: HCSV_reg_corrJERUp_mass_LowCentral HCSV_reg_corrJERUp_pt_LowCentral VHbb::deltaPhi(HCSV_reg_corrJERUp_phi_LowCentral,V_phi) Jet_btagCSV[hJCidx[0]] Jet_btagCSV[hJCidx[1]] Jet_pt_reg_corrJERUp_LowCentral[hJCidx[0]] Jet_pt_reg_corrJERUp_LowCentral[hJCidx[1]] V_mass Sum$(Jet_pt_reg_corrJERUp_LowCentral>30&&abs(Jet_eta)<2.4&&Jet_puId==7&&Jet_id>0&&aJCidx!=(hJCidx[0])&&(aJCidx!=(hJCidx[1]))) V_pt (HCSV_reg_corrJERUp_pt_LowCentral/V_pt) abs(Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]]) softActivityVH_njets5 VHbb::deltaR(HCSV_reg_corrJERUp_eta_LowCentral,HCSV_reg_corrJERUp_phi_LowCentral,V_eta,V_phi) met_pt

JER_Down_LowCentral: HCSV_reg_corrJERDown_mass_LowCentral HCSV_reg_corrJERDown_pt_LowCentral VHbb::deltaPhi(HCSV_reg_corrJERDown_phi_LowCentral,V_phi) Jet_btagCSV[hJCidx[0]] Jet_btagCSV[hJCidx[1]] Jet_pt_reg_corrJERDown_LowCentral[hJCidx[0]] Jet_pt_reg_corrJERDown_LowCentral[hJCidx[1]] V_mass Sum$(Jet_pt_reg_corrJERDown_LowCentral>30&&abs(Jet_eta)<2.4&&Jet_puId==7&&Jet_id>0&&aJCidx!=(hJCidx[0])&&(aJCidx!=(hJCidx[1]))) V_pt (HCSV_reg_corrJERDown_pt_LowCentral/V_pt) abs(Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]]) softActivityVH_njets5 VHbb::deltaR(HCSV_reg_corrJERDown_eta_LowCentral,HCSV_reg_corrJERDown_phi_LowCentral,V_eta,V_phi) met_pt

JER_Up_HighForward: HCSV_reg_corrJERUp_mass_HighForward HCSV_reg_corrJERUp_pt_HighForward VHbb::deltaPhi(HCSV_reg_corrJERUp_phi_HighForward,V_phi) Jet_btagCSV[hJCidx[0]] Jet_btagCSV[hJCidx[1]] Jet_pt_reg_corrJERUp_HighForward[hJCidx[0]] Jet_pt_reg_corrJERUp_HighForward[hJCidx[1]] V_mass Sum$(Jet_pt_reg_corrJERUp_HighForward>30&&abs(Jet_eta)<2.4&&Jet_puId==7&&Jet_id>0&&aJCidx!=(hJCidx[0])&&(aJCidx!=(hJCidx[1]))) V_pt (HCSV_reg_corrJERUp_pt_HighForward/V_pt) abs(Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]]) softActivityVH_njets5 VHbb::deltaR(HCSV_reg_corrJERUp_eta_HighForward,HCSV_reg_corrJERUp_phi_HighForward,V_eta,V_phi) met_pt

JER_Down_HighForward: HCSV_reg_corrJERDown_mass_HighForward HCSV_reg_corrJERDown_pt_HighForward VHbb::deltaPhi(HCSV_reg_corrJERDown_phi_HighForward,V_phi) Jet_btagCSV[hJCidx[0]] Jet_btagCSV[hJCidx[1]] Jet_pt_reg_corrJERDown_HighForward[hJCidx[0]] Jet_pt_reg_corrJERDown_HighForward[hJCidx[1]] V_mass Sum$(Jet_pt_reg_corrJERDown_HighForward>30&&abs(Jet_eta)<2.4&&Jet_puId==7&&Jet_id>0&&aJCidx!=(hJCidx[0])&&(aJCidx!=(hJCidx[1]))) V_pt (HCSV_reg_corrJERDown_pt_HighForward/V_pt) abs(Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]]) softActivityVH_njets5 VHbb::deltaR(HCSV_reg_corrJERDown_eta_HighForward,HCSV_reg_corrJERDown_phi_HighForward,V_eta,V_phi) met_pt

JER_Up_LowForward: HCSV_reg_corrJERUp_mass_LowForward HCSV_reg_corrJERUp_pt_LowForward VHbb::deltaPhi(HCSV_reg_corrJERUp_phi_LowForward,V_phi) Jet_btagCSV[hJCidx[0]] Jet_btagCSV[hJCidx[1]] Jet_pt_reg_corrJERUp_LowForward[hJCidx[0]] Jet_pt_reg_corrJERUp_LowForward[hJCidx[1]] V_mass Sum$(Jet_pt_reg_corrJERUp_LowForward>30&&abs(Jet_eta)<2.4&&Jet_puId==7&&Jet_id>0&&aJCidx!=(hJCidx[0])&&(aJCidx!=(hJCidx[1]))) V_pt (HCSV_reg_corrJERUp_pt_LowForward/V_pt) abs(Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]]) softActivityVH_njets5 VHbb::deltaR(HCSV_reg_corrJERUp_eta_LowForward,HCSV_reg_corrJERUp_phi_LowForward,V_eta,V_phi) met_pt

JER_Down_LowForward: HCSV_reg_corrJERDown_mass_LowForward HCSV_reg_corrJERDown_pt_LowForward VHbb::deltaPhi(HCSV_reg_corrJERDown_phi_LowForward,V_phi) Jet_btagCSV[hJCidx[0]] Jet_btagCSV[hJCidx[1]] Jet_pt_reg_corrJERDown_LowForward[hJCidx[0]] Jet_pt_reg_corrJERDown_LowForward[hJCidx[1]] V_mass Sum$(Jet_pt_reg_corrJERDown_LowForward>30&&abs(Jet_eta)<2.4&&Jet_puId==7&&Jet_id>0&&aJCidx!=(hJCidx[0])&&(aJCidx!=(hJCidx[1]))) V_pt (HCSV_reg_corrJERDown_pt_LowForward/V_pt) abs(Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]]) softActivityVH_njets5 VHbb::deltaR(HCSV_reg_corrJERDown_eta_LowForward,HCSV_reg_corrJERDown_phi_LowForward,V_eta,V_phi) met_pt

JEC_Up_HighCentral: HCSV_reg_corrJECUp_mass_HighCentral HCSV_reg_corrJECUp_pt_HighCentral VHbb::deltaPhi(HCSV_reg_corrJECUp_phi_HighCentral,V_phi) Jet_btagCSV[hJCidx[0]] Jet_btagCSV[hJCidx[1]] Jet_pt_reg_corrJECUp_HighCentral[hJCidx[0]] Jet_pt_reg_corrJECUp_HighCentral[hJCidx[1]] V_mass Sum$(Jet_pt_reg_corrJECUp_HighCentral>30&&abs(Jet_eta)<2.4&&Jet_puId==7&&Jet_id>0&&aJCidx!=(hJCidx[0])&&(aJCidx!=(hJCidx[1]))) V_pt (HCSV_reg_corrJECUp_pt_HighCentral/V_pt) abs(Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]]) softActivityVH_njets5 VHbb::deltaR(HCSV_reg_corrJECUp_eta_HighCentral,HCSV_reg_corrJECUp_phi_HighCentral,V_eta,V_phi) met_pt

JEC_Down_HighCentral: HCSV_reg_corrJECDown_mass_HighCentral HCSV_reg_corrJECDown_pt_HighCentral VHbb::deltaPhi(HCSV_reg_corrJECDown_phi_HighCentral,V_phi) Jet_btagCSV[hJCidx[0]] Jet_btagCSV[hJCidx[1]] Jet_pt_reg_corrJECDown_HighCentral[hJCidx[0]] Jet_pt_reg_corrJECDown_HighCentral[hJCidx[1]] V_mass Sum$(Jet_pt_reg_corrJECDown_HighCentral>30&&abs(Jet_eta)<2.4&&Jet_puId==7&&Jet_id>0&&aJCidx!=(hJCidx[0])&&(aJCidx!=(hJCidx[1]))) V_pt (HCSV_reg_corrJECDown_pt_HighCentral/V_pt) abs(Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]]) softActivityVH_njets5 VHbb::deltaR(HCSV_reg_corrJECDown_eta_HighCentral,HCSV_reg_corrJECDown_phi_HighCentral,V_eta,V_phi) met_pt

JEC_Up_LowCentral: HCSV_reg_corrJECUp_mass_LowCentral HCSV_reg_corrJECUp_pt_LowCentral VHbb::deltaPhi(HCSV_reg_corrJECUp_phi_LowCentral,V_phi) Jet_btagCSV[hJCidx[0]] Jet_btagCSV[hJCidx[1]] Jet_pt_reg_corrJECUp_LowCentral[hJCidx[0]] Jet_pt_reg_corrJECUp_LowCentral[hJCidx[1]] V_mass Sum$(Jet_pt_reg_corrJECUp_LowCentral>30&&abs(Jet_eta)<2.4&&Jet_puId==7&&Jet_id>0&&aJCidx!=(hJCidx[0])&&(aJCidx!=(hJCidx[1]))) V_pt (HCSV_reg_corrJECUp_pt_LowCentral/V_pt) abs(Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]]) softActivityVH_njets5 VHbb::deltaR(HCSV_reg_corrJECUp_eta_LowCentral,HCSV_reg_corrJECUp_phi_LowCentral,V_eta,V_phi) met_pt

JEC_Down_LowCentral: HCSV_reg_corrJECDown_mass_LowCentral HCSV_reg_corrJECDown_pt_LowCentral VHbb::deltaPhi(HCSV_reg_corrJECDown_phi_LowCentral,V_phi) Jet_btagCSV[hJCidx[0]] Jet_btagCSV[hJCidx[1]] Jet_pt_reg_corrJECDown_LowCentral[hJCidx[0]] Jet_pt_reg_corrJECDown_LowCentral[hJCidx[1]] V_mass Sum$(Jet_pt_reg_corrJECDown_LowCentral>30&&abs(Jet_eta)<2.4&&Jet_puId==7&&Jet_id>0&&aJCidx!=(hJCidx[0])&&(aJCidx!=(hJCidx[1]))) V_pt (HCSV_reg_corrJECDown_pt_LowCentral/V_pt) abs(Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]]) softActivityVH_njets5 VHbb::deltaR(HCSV_reg_corrJECDown_eta_LowCentral,HCSV_reg_corrJECDown_phi_LowCentral,V_eta,V_phi) met_pt

JEC_Up_HighForward: HCSV_reg_corrJECUp_mass_HighForward HCSV_reg_corrJECUp_pt_HighForward VHbb::deltaPhi(HCSV_reg_corrJECUp_phi_HighForward,V_phi) Jet_btagCSV[hJCidx[0]] Jet_btagCSV[hJCidx[1]] Jet_pt_reg_corrJECUp_HighForward[hJCidx[0]] Jet_pt_reg_corrJECUp_HighForward[hJCidx[1]] V_mass Sum$(Jet_pt_reg_corrJECUp_HighForward>30&&abs(Jet_eta)<2.4&&Jet_puId==7&&Jet_id>0&&aJCidx!=(hJCidx[0])&&(aJCidx!=(hJCidx[1]))) V_pt (HCSV_reg_corrJECUp_pt_HighForward/V_pt) abs(Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]]) softActivityVH_njets5 VHbb::deltaR(HCSV_reg_corrJECUp_eta_HighForward,HCSV_reg_corrJECUp_phi_HighForward,V_eta,V_phi) met_pt

JEC_Down_HighForward: HCSV_reg_corrJECDown_mass_HighForward HCSV_reg_corrJECDown_pt_HighForward VHbb::deltaPhi(HCSV_reg_corrJECDown_phi_HighForward,V_phi) Jet_btagCSV[hJCidx[0]] Jet_btagCSV[hJCidx[1]] Jet_pt_reg_corrJECDown_HighForward[hJCidx[0]] Jet_pt_reg_corrJECDown_HighForward[hJCidx[1]] V_mass Sum$(Jet_pt_reg_corrJECDown_HighForward>30&&abs(Jet_eta)<2.4&&Jet_puId==7&&Jet_id>0&&aJCidx!=(hJCidx[0])&&(aJCidx!=(hJCidx[1]))) V_pt (HCSV_reg_corrJECDown_pt_HighForward/V_pt) abs(Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]]) softActivityVH_njets5 VHbb::deltaR(HCSV_reg_corrJECDown_eta_HighForward,HCSV_reg_corrJECDown_phi_HighForward,V_eta,V_phi) met_pt

JEC_Up_LowForward: HCSV_reg_corrJECUp_mass_LowForward HCSV_reg_corrJECUp_pt_LowForward VHbb::deltaPhi(HCSV_reg_corrJECUp_phi_LowForward,V_phi) Jet_btagCSV[hJCidx[0]] Jet_btagCSV[hJCidx[1]] Jet_pt_reg_corrJECUp_LowForward[hJCidx[0]] Jet_pt_reg_corrJECUp_LowForward[hJCidx[1]] V_mass Sum$(Jet_pt_reg_corrJECUp_LowForward>30&&abs(Jet_eta)<2.4&&Jet_puId==7&&Jet_id>0&&aJCidx!=(hJCidx[0])&&(aJCidx!=(hJCidx[1]))) V_pt (HCSV_reg_corrJECUp_pt_LowForward/V_pt) abs(Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]]) softActivityVH_njets5 VHbb::deltaR(HCSV_reg_corrJECUp_eta_LowForward,HCSV_reg_corrJECUp_phi_LowForward,V_eta,V_phi) met_pt

JEC_Down_LowForward: HCSV_reg_corrJECDown_mass_LowForward HCSV_reg_corrJECDown_pt_LowForward VHbb::deltaPhi(HCSV_reg_corrJECDown_phi_LowForward,V_phi) Jet_btagCSV[hJCidx[0]] Jet_btagCSV[hJCidx[1]] Jet_pt_reg_corrJECDown_LowForward[hJCidx[0]] Jet_pt_reg_corrJECDown_LowForward[hJCidx[1]] V_mass Sum$(Jet_pt_reg_corrJECDown_LowForward>30&&abs(Jet_eta)<2.4&&Jet_puId==7&&Jet_id>0&&aJCidx!=(hJCidx[0])&&(aJCidx!=(hJCidx[1]))) V_pt (HCSV_reg_corrJECDown_pt_LowForward/V_pt) abs(Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]]) softActivityVH_njets5 VHbb::deltaR(HCSV_reg_corrJECDown_eta_LowForward,HCSV_reg_corrJECDown_phi_LowForward,V_eta,V_phi) met_pt

[Weights]

;_*_*_*_
;Nominal
;_*_*_*_
PUWeight:  VHbb::puWeight_ichep(nTrueInt)
puWeightUp: VHbb::puWeight_ichep_up(nTrueInt)
puWeightDown: VHbb::puWeight_ichep_down(nTrueInt)
GenSign:  sign(genWeight)
BTagWeight: bTagWeightICHEP
Trigger: triggerEmulationWeight
specialweight: DY_specialWeight
weightF_EWK: VHbb::ptWeightEWK_Zll(nGenVbosons[0], GenVbosons_pt[0], VtypeSim, nGenTop, nGenHiggsBoson)
lep_SF2: (eleweight[0]*weight_Eff_eletriglooseBCD[0]*muweight[0]*weight_Eff_mutriglooseICHEP[0])
sysweight: <!Weights|PUWeight!>*<!Weights|GenSign!>*<!Weights|BTagWeight!>

;mu SF
weightF_muSFid: vLeptons_SF_IdCutLoose[0]*vLeptons_SF_IdCutLoose[1]
weightF_muSFiso: vLeptons_SF_IsoLoose[0]*vLeptons_SF_IsoLoose[1]
weightF_muSFtrigg: vLeptons_SFweight_HLT

;Lepton_weigts

;V25

;weightF: sign(genWeight)*bTagWeightCSV_Moriond*puWeight
;weightF: <!Weights|sysweight!>*<!Weights|lep_SF2!>
weightF: 1


;_*_*_*_
;Up/Down
;_*_*_*_

;lhe scale

CMS_vhbb_LHE_weights_scale_muR_ZH_UP:  <!Weights|weightF!>*LHE_weights_scale_wgt[2+2]
CMS_vhbb_LHE_weights_scale_muR_ggZH_UP:  <!Weights|weightF!>*LHE_weights_scale_wgt[2+2]
CMS_vhbb_LHE_weights_scale_muR_TT_UP:  <!Weights|weightF!>*LHE_weights_scale_wgt[2+2]
CMS_vhbb_LHE_weights_scale_muR_DYlight_UP:  <!Weights|weightF!>*LHE_weights_scale_wgt[2+2]
CMS_vhbb_LHE_weights_scale_muR_DY1b_UP:  <!Weights|weightF!>*LHE_weights_scale_wgt[2+2]
CMS_vhbb_LHE_weights_scale_muR_DY2b_UP:  <!Weights|weightF!>*LHE_weights_scale_wgt[2+2]
CMS_vhbb_LHE_weights_scale_muR_ZH_DOWN: <!Weights|weightF!>*LHE_weights_scale_wgt[3+2]
CMS_vhbb_LHE_weights_scale_muR_ggZH_DOWN: <!Weights|weightF!>*LHE_weights_scale_wgt[3+2]
CMS_vhbb_LHE_weights_scale_muR_TT_DOWN: <!Weights|weightF!>*LHE_weights_scale_wgt[3+2]
CMS_vhbb_LHE_weights_scale_muR_DYlight_DOWN: <!Weights|weightF!>*LHE_weights_scale_wgt[3+2]
CMS_vhbb_LHE_weights_scale_muR_DY1b_DOWN: <!Weights|weightF!>*LHE_weights_scale_wgt[3+2]
CMS_vhbb_LHE_weights_scale_muR_DY2b_DOWN: <!Weights|weightF!>*LHE_weights_scale_wgt[3+2]


CMS_vhbb_LHE_weights_scale_muF_ZH_UP: <!Weights|weightF!>*LHE_weights_scale_wgt[0+2]
CMS_vhbb_LHE_weights_scale_muF_ggZH_UP: <!Weights|weightF!>*LHE_weights_scale_wgt[0+2]
CMS_vhbb_LHE_weights_scale_muF_TT_UP: <!Weights|weightF!>*LHE_weights_scale_wgt[0+2]
CMS_vhbb_LHE_weights_scale_muF_DYlight_UP: <!Weights|weightF!>*LHE_weights_scale_wgt[0+2]
CMS_vhbb_LHE_weights_scale_muF_DY1b_UP: <!Weights|weightF!>*LHE_weights_scale_wgt[0+2]
CMS_vhbb_LHE_weights_scale_muF_DY2b_UP: <!Weights|weightF!>*LHE_weights_scale_wgt[0+2]
CMS_vhbb_LHE_weights_scale_muF_ZH_DOWN: <!Weights|weightF!>*LHE_weights_scale_wgt[1+2]
CMS_vhbb_LHE_weights_scale_muF_ggZH_DOWN: <!Weights|weightF!>*LHE_weights_scale_wgt[1+2]
CMS_vhbb_LHE_weights_scale_muF_TT_DOWN: <!Weights|weightF!>*LHE_weights_scale_wgt[1+2]
CMS_vhbb_LHE_weights_scale_muF_DYlight_DOWN: <!Weights|weightF!>*LHE_weights_scale_wgt[1+2]
CMS_vhbb_LHE_weights_scale_muF_DY1b_DOWN: <!Weights|weightF!>*LHE_weights_scale_wgt[1+2]
CMS_vhbb_LHE_weights_scale_muF_DY2b_DOWN: <!Weights|weightF!>*LHE_weights_scale_wgt[1+2]


;old (kept as ref)
;CMS_vhbb_LHE_weights_scaleMuF_UP: <!Weights|weightF!>*LHE_weights_scale_wgt[0+2]
;CMS_vhbb_LHE_weights_scaleMuF_DOWN: <!Weights|weightF!>*LHE_weights_scale_wgt[1+2]
;CMS_vhbb_LHE_weights_scaleMuR_UP:  <!Weights|weightF!>*LHE_weights_scale_wgt[2+2]
;CMS_vhbb_LHE_weights_scaleMuR_DOWN: <!Weights|weightF!>*LHE_weights_scale_wgt[3+2]

;lepton SF
CMS_vhbb_eff_e_13TeV_UP: <!Weights|sysweight!>*((Vtype == 1)*eleweight[1]*weight_Eff_eletriglooseBCD[1] + (Vtype == 0)*muweight[0]*weight_Eff_mutriglooseICHEP[0])
CMS_vhbb_eff_e_13TeV_DOWN: <!Weights|sysweight!>*((Vtype == 1)*eleweight[2]*weight_Eff_eletriglooseBCD[2] + (Vtype == 0)*muweight[0]*weight_Eff_mutriglooseICHEP[0])
CMS_vhbb_eff_m_13TeV_UP: <!Weights|sysweight!>*((Vtype == 1)*eleweight[0]*weight_Eff_eletriglooseBCD[0] + (Vtype == 0)*muweight[1]*weight_Eff_mutriglooseICHEP[1])
CMS_vhbb_eff_m_13TeV_DOWN: <!Weights|sysweight!>*((Vtype == 1)*eleweight[0]*weight_Eff_eletriglooseBCD[0] + (Vtype == 0)*muweight[2]*weight_Eff_mutriglooseICHEP[2])

;bTag
weight_noBTag: <!Weights|PUWeight!>*<!Weights|GenSign!>*<!Weights|lep_SF2!>

btagWeightCSV_lf_HighCentral_UP:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFHighCentralUp
btagWeightCSV_lf_LowCentral_UP:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFLowCentralUp
btagWeightCSV_lf_HighForward_UP:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFHighForwardUp
btagWeightCSV_lf_LowForward_UP:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFLowForwardUp
btagWeightCSV_hf_HighCentral_UP:    <!Weights|weight_noBTag!>*bTagWeightICHEP_HFHighCentralUp
btagWeightCSV_hf_LowCentral_UP:    <!Weights|weight_noBTag!>*bTagWeightICHEP_HFLowCentralUp
btagWeightCSV_hf_HighForward_UP:    <!Weights|weight_noBTag!>*bTagWeightICHEP_HFHighForwardUp
btagWeightCSV_hf_LowForward_UP:    <!Weights|weight_noBTag!>*bTagWeightICHEP_HFLowForwardUp
btagWeightCSV_lfstats1_HighCentral_UP:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFStats1HighCentralUp
btagWeightCSV_lfstats1_LowCentral_UP:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFStats1LowCentralUp
btagWeightCSV_lfstats1_HighForward_UP:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFStats1HighForwardUp
btagWeightCSV_lfstats1_LowForward_UP:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFStats1LowForwardUp
btagWeightCSV_lfstats2_HighCentral_UP:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFStats2HighCentralUp
btagWeightCSV_lfstats2_LowCentral_UP:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFStats2LowCentralUp
btagWeightCSV_lfstats2_HighForward_UP:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFStats2HighForwardUp
btagWeightCSV_lfstats2_LowForward_UP:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFStats2LowForwardUp
btagWeightCSV_hfstats1_HighCentral_UP:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFStats1HighCentralUp
btagWeightCSV_hfstats1_LowCentral_UP:    <!Weights|weight_noBTag!>*bTagWeightICHEP_HFStats1LowCentralUp
btagWeightCSV_hfstats1_HighForward_UP:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFStats1HighForwardUp
btagWeightCSV_hfstats1_LowForward_UP:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFStats1LowForwardUp
btagWeightCSV_hfstats2_HighCentral_UP:    <!Weights|weight_noBTag!>*bTagWeightICHEP_cErr1HighCentralUp
btagWeightCSV_hfstats2_LowCentral_UP:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFStats2LowCentralUp
btagWeightCSV_hfstats2_HighForward_UP:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFStats2HighForwardUp
btagWeightCSV_hfstats2_LowForward_UP:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFStats2LowForwardUp
btagWeightCSV_cferr1_HighCentral_UP:    <!Weights|weight_noBTag!>*bTagWeightICHEP_cErr1HighCentralUp
btagWeightCSV_cferr1_LowCentral_UP:    <!Weights|weight_noBTag!>*bTagWeightICHEP_cErr1LowCentralUp
btagWeightCSV_cferr1_HighForward_UP:    <!Weights|weight_noBTag!>*bTagWeightICHEP_cErr1HighForwardUp
btagWeightCSV_cferr1_LowForward_UP:    <!Weights|weight_noBTag!>*bTagWeightICHEP_cErr1LowForwardUp
btagWeightCSV_cferr2_HighCentral_UP:    <!Weights|weight_noBTag!>*bTagWeightICHEP_cErr2HighCentralUp
btagWeightCSV_cferr2_LowCentral_UP:    <!Weights|weight_noBTag!>*bTagWeightICHEP_cErr2LowCentralUp
btagWeightCSV_cferr2_HighForward_UP:    <!Weights|weight_noBTag!>*bTagWeightICHEP_cErr1HighForwardUp
btagWeightCSV_cferr2_LowForward_UP:    <!Weights|weight_noBTag!>*bTagWeightICHEP_cErr2LowForwardUp

btagWeightCSV_lf_HighCentral_DOWN:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFHighCentralDown
btagWeightCSV_lf_LowCentral_DOWN:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFLowCentralDown
btagWeightCSV_lf_HighForward_DOWN:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFHighForwardDown
btagWeightCSV_lf_LowForward_DOWN:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFLowForwardDown
btagWeightCSV_hf_HighCentral_DOWN:    <!Weights|weight_noBTag!>*bTagWeightICHEP_HFHighCentralDown
btagWeightCSV_hf_LowCentral_DOWN:    <!Weights|weight_noBTag!>*bTagWeightICHEP_HFLowCentralDown
btagWeightCSV_hf_HighForward_DOWN:    <!Weights|weight_noBTag!>*bTagWeightICHEP_HFHighForwardDown
btagWeightCSV_hf_LowForward_DOWN:    <!Weights|weight_noBTag!>*bTagWeightICHEP_HFLowForwardDown
btagWeightCSV_lfstats1_HighCentral_DOWN:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFStats1HighCentralDown
btagWeightCSV_lfstats1_LowCentral_DOWN:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFStats1LowCentralDown
btagWeightCSV_lfstats1_HighForward_DOWN:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFStats1HighForwardDown
btagWeightCSV_lfstats1_LowForward_DOWN:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFStats1LowForwardDown
btagWeightCSV_lfstats2_HighCentral_DOWN:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFStats2HighCentralDown
btagWeightCSV_lfstats2_LowCentral_DOWN:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFStats2LowCentralDown
btagWeightCSV_lfstats2_HighForward_DOWN:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFStats2HighForwardDown
btagWeightCSV_lfstats2_LowForward_DOWN:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFStats2LowForwardDown
btagWeightCSV_hfstats1_HighCentral_DOWN:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFStats1HighCentralDown
btagWeightCSV_hfstats1_LowCentral_DOWN:    <!Weights|weight_noBTag!>*bTagWeightICHEP_HFStats1LowCentralDown
btagWeightCSV_hfstats1_HighForward_DOWN:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFStats1HighForwardDown
btagWeightCSV_hfstats1_LowForward_DOWN:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFStats1LowForwardDown
btagWeightCSV_hfstats2_HighCentral_DOWN:    <!Weights|weight_noBTag!>*bTagWeightICHEP_cErr1HighCentralDown
btagWeightCSV_hfstats2_LowCentral_DOWN:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFStats2LowCentralDown
btagWeightCSV_hfstats2_HighForward_DOWN:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFStats2HighForwardDown
btagWeightCSV_hfstats2_LowForward_DOWN:    <!Weights|weight_noBTag!>*bTagWeightICHEP_LFStats2LowForwardDown
btagWeightCSV_cferr1_HighCentral_DOWN:    <!Weights|weight_noBTag!>*bTagWeightICHEP_cErr1HighCentralDown
btagWeightCSV_cferr1_LowCentral_DOWN:    <!Weights|weight_noBTag!>*bTagWeightICHEP_cErr1LowCentralDown
btagWeightCSV_cferr1_HighForward_DOWN:    <!Weights|weight_noBTag!>*bTagWeightICHEP_cErr1HighForwardDown
btagWeightCSV_cferr1_LowForward_DOWN:    <!Weights|weight_noBTag!>*bTagWeightICHEP_cErr1LowForwardDown
btagWeightCSV_cferr2_HighCentral_DOWN:    <!Weights|weight_noBTag!>*bTagWeightICHEP_cErr2HighCentralDown
btagWeightCSV_cferr2_LowCentral_DOWN:    <!Weights|weight_noBTag!>*bTagWeightICHEP_cErr2LowCentralDown
btagWeightCSV_cferr2_HighForward_DOWN:    <!Weights|weight_noBTag!>*bTagWeightICHEP_cErr1HighForwardDown
btagWeightCSV_cferr2_LowForward_DOWN:    <!Weights|weight_noBTag!>*bTagWeightICHEP_cErr2LowForwardDown

